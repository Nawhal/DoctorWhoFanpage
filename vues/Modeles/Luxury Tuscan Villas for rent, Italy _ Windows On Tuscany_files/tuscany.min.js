jQuery(function(a){TUSCANY_GALLERY.init=function(){a("#main_gallery").flexslider({animation:"fade",controlNav:!1,animationLoop:!1,slideshow:!1,start:function(){a("#thumbs_gallery .flex-prev").hide()},before:function(){},after:function(){}}),a("#thumbs_gallery").flexslider({animation:"slide",controlNav:!1,animationLoop:!1,slideshow:!1,itemWidth:52,itemMargin:4,move:1,after:function(b){0==b.currentSlide?a("#thumbs_gallery .flex-prev").hide():a("#thumbs_gallery .flex-prev").show(),b.currentSlide+10>=b.count?a("#thumbs_gallery .flex-next").hide():a("#thumbs_gallery .flex-next").show()}}),a("body").delegate("#main_gallery .flex-direction-nav .flex-prev","click",function(){var b=a("#main_gallery").data("flexslider").find("img.lazy"),c=a("#main_gallery").data("flexslider").currentSlide-1,d=b[c];return a(d).attr("src",a(d).data("original")),a(d).load(function(){a("#main_gallery").data("flexslider").flexAnimate(c)}),!1}),a("body").delegate("#main_gallery .flex-direction-nav .flex-next","click",function(){var b=a("#main_gallery").data("flexslider").find("img.lazy"),c=a("#main_gallery").data("flexslider").currentSlide+1,d=b[c];return a(d).attr("src",a(d).data("original")),a(d).load(function(){a("#main_gallery").data("flexslider").flexAnimate(c)}),!1}),a("body").delegate("#thumbs_gallery ul li img","click",function(){if($pos=parseInt(a("#thumbs_gallery ul li img").index(this)),$cur=parseInt(a("#main_gallery").data("flexslider").currentSlide),!isNaN($pos)&&!isNaN($cur)&&$pos!=$cur){TUSCANY_GALLERY.position=$pos;var b=a("#main_gallery").data("flexslider").find("img.lazy"),c=b[$pos];return a("#main_gallery .loader").fadeTo("fast",.7),a(c).attr("src",a(c).data("original")),a(c).load(function(){a("#main_gallery .loader").fadeTo("fast",0,function(){a("#main_gallery .loader").hide()}),a("#main_gallery").data("flexslider").flexAnimate($pos)}),!1}})},a("#main_gallery .loader").delay(500).fadeOut()}),jQuery(function(a){var b="http://"+document.domain+"/",c=b+"wp-content/themes/tuscany/",d=!1;d=a("html").hasClass("ie8")||a("html").hasClass("ie7")?!0:!1;var e=a("#content"),f=a("#page_load"),g=!1,h=!1,i=!1,j=!1,k="easeInOutExpo",l="easeOutExpo",m=!1,n=!1,o=!0,p=!0,q="",r="";TUSCANY.detectScreen=function(){$window_width=parseInt(a(window).width()),640>=$window_width?(m=!0,n=!1,o=!1,p=!1):$window_width>=641&&1024>=$window_width?(m=!1,n=!0,o=!1,p=!1):$window_width>=1025&&1399>=$window_width?(m=!1,n=!1,o=!0,p=!1):(m=!1,n=!1,o=!1,p=!0)},TUSCANY.preloading=function(){a(window).load(function(){a("#preload_site").fadeOut()})},TUSCANY.ajaxNavigation={},TUSCANY.ajaxNavigation.header=function(){d||a("header a, #city_menu a").on("click",function(){return $url=a(this).attr("href"),"#"!=$url&&TUSCANY.ajaxNavigation.changePage($url),!1})},TUSCANY.ajaxNavigation.content=function(){d||a("#content a").not(".open_popup").on("click",function(){return $url=a(this).attr("href"),TUSCANY.ajaxNavigation.changePage($url),!1})},TUSCANY.ajaxNavigation.changePage=function(b){return document.URL!=b&&document.URL!=b+"/"&&($check_url=new RegExp(location.host),$check_url.test(b))?(g=!1,a("html, body").animate({scrollTop:0},400,k),a("#city_menu").stop(!0).slideUp(400,k),History.pushState(null,"Loading...",b),!1):void 0},TUSCANY.ajaxNavigation.loadPage=function(b){h=!1,a.ajax({url:"/proxy.php",data:"url="+b,dataType:"json",beforeSend:function(){f.fadeIn(),e.css("min-height",a(window).height()),q&&q.hide(),r&&r.hide()},error:function(a,b,c){console.log(b,c)},success:function(b){g=!0,$html=b.html;a($html).find("img").length;h=!0,TUSCANY.ajaxNavigation.animation(b)}})},TUSCANY.ajaxNavigation.animation=function(b){h&&(clearTimeout(i),"undefined"!=typeof $url&&(console.log($url),History.replaceState(null,b.title,$url)),f.fadeOut(200,function(){$container_first=a("#content .container").eq(0),$container_first.addClass("temporary"),a("#content").append('<div id="content_temp" style="right:-'+parseInt($container_first.innerWidth())+'px;">'+b.html+"</div>"),$content_temp=a("#content_temp"),morepage_loading=!1,gallery_loading=!1,$container_first.delay(800).animate({"margin-left":-$container_first.innerWidth()},1400,k),$content_temp.delay(800).animate({right:0},1200,k,function(){$container_first.remove(),a("#content_temp").attr("id",""),b.callback&&TUSCANY[b.callback](),e.css("min-height","auto"),a("#main_gallery .loader").delay(500).fadeOut(),console.log(a('#content select[name="city"] option:selected').text()),$city=a('#content select[name="city"] option:selected').text().toUpperCase()+" VILLAS",$side=a('#content select[name="side"] option:selected').text().toUpperCase(),"ALL SIDE"!=$side&&($city=$side),a("#action_bar span").first().text(a("#items .item:visible").length+" "+$city)})}),g=!1)},History.Adapter.bind(window,"statechange",function(){var b=History.getState();g||(a("html, body").animate({scrollTop:0},400,k),TUSCANY.ajaxNavigation.loadPage(b.url))}),TUSCANY.parseCallback=function(){$callback=!1,$callback=a("html").find(".container[data-callback]").attr("data-callback"),$callback&&TUSCANY[$callback]()},TUSCANY.parallax=function(){$window=a(window),a("[data-type]").each(function(){a(this).data("offsetY",parseInt(a(this).attr("data-offsetY"))),a(this).data("speed",a(this).attr("data-speed"))}),a('[data-type="background"]').each(function(){var b=a(this),c=b.offset(),d=c.top;a(window).scroll(function(){if($window.scrollTop()+$window.height()>d&&d+b.height()>$window.scrollTop()){var a=-($window.scrollTop()/b.data("speed"));b.data("offsetY")&&(a+=b.data("offsetY"));var c="50% "+a+"px";b.css({backgroundPosition:c})}})})},TUSCANY.cityMenu=function(){$city_pos=1,a("#menu ul li a").mouseover(function(){a("#menu ul li a").index(this)==$city_pos?a("#city_menu").stop(!0).slideDown(400,k):a("#city_menu").stop(!0).slideUp(400,k)}),a("#city_menu").mouseleave(function(){a(this).stop(!0).slideUp()}),$city_menu="<ul>",$city_menu+=a("#city_menu .container ul").eq(0).html(),$city_menu+=a("#city_menu .container ul").eq(1).html(),$city_menu+=a("#city_menu .container ul").eq(2).html(),$city_menu+="</ul>",a("#menu_mobile ul li").eq(1).addClass("sub").append($city_menu),a("#menu_mobile_trigger").on("click",function(){return a("#menu_mobile").slideToggle(400,k),a("#action_bar").toggle(),!1}),a("#menu_mobile a").on("click",function(){return a("#menu_mobile").slideUp(400,k),$url=a(this).attr("href"),"#"!=$url&&TUSCANY.ajaxNavigation.changePage($url),!1})},TUSCANY.customSelect=function(){a("select.custom").selectbox({effect:"slide"}),a(".sbOptions").each(function(){a(this).find("li").eq(0).append('<span class="suparrow"></span>')})},TUSCANY.tplHome=function(){function b(){$map_hover=!1,$promo_main=a("#promo_main"),$promo_image=$promo_main.find(".image"),$promo_map=$promo_main.find(".map"),$promo_map.mouseover(function(){a("#mapClaim").fadeOut(200,function(){$map_hover=!0,(o||p)&&($promo_image.stop(!0).animate({left:-220},400,l),$promo_map.stop(!0).animate({right:0},600,l))})}),$promo_map.mouseleave(function(){o||p?($promo_image.stop(!0).animate({left:0},400,l),$promo_map.stop(!0).animate({right:-90},600,l,function(){$map_hover=!1,a("#mapClaim").fadeIn(200)})):($map_hover=!1,a("#mapClaim").fadeIn(200))})}function c(){a(".map area").on("mouseover",function(){$map_hover&&($pos=a(".map area").index(this),a("#mapPins .pin").eq($pos).stop(!0,!0).fadeIn(200))}),a(".map area").on("mouseout",function(){$map_hover&&($pos=a(".map area").index(this),a("#mapPins .pin").eq($pos).stop(!0,!0).fadeOut(200))}),a(".map area").on("click",function(){return $map_hover&&($url=a(this).attr("href"),"#"!=$url&&TUSCANY.ajaxNavigation.changePage($url)),!1})}function d(){a(".box .flexslider").each(function(){$delay=parseInt(a(this).attr("data-delay")),$speed=5e3,a(this).flexslider({slideshowSpeed:$speed,initDelay:$delay})})}this.changePage(),b(),c(),d()},TUSCANY.tplContact=function(){function b(){{var a=new google.maps.LatLng(43.768777,11.246416),b={center:a,zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},d=new google.maps.Map(document.getElementById("contact_map"),b),e=c+"img/pin_map.png";new google.maps.Marker({position:a,map:d,icon:e})}}this.changePage(),a("#form_contact").jmValidation({type:"ajax",service:a("#form_contact").attr("action")}),b()},TUSCANY.tplListato=function(){function d(){q=a("#start_date").datepicker({}).on("changeDate",function(b){if(b.date.valueOf()>r.date.valueOf()){var c=new Date(b.date);c.setDate(c.getDate()+1),r.setValue(c)}q.hide(),a("#end_date")[0].focus()}).on("show",function(){r.hide()}).data("datepicker"),r=a("#end_date").datepicker({}).on("changeDate",function(){r.hide()}).on("show",function(){q.hide()}).data("datepicker")}function e(){$filters=new Array("swimming_pool","internet","air_conditioning","biliardo","spa","jacuzzi","animal_friendly","parking","golf","garden_bbq","tv_sat","sauna","barriers","tennis");for(var b in $filters)a(".item[data-"+$filters[b]+'="on"]').length||a('input[name="'+$filters[b]+'"]').parent("li").hide();$filters=new Array("seaside-villas","countryside-villas");for(var b in $filters)a('.item[data-side="'+$filters[b]+'"]').length||a("#type_villa").hide();$filters=new Array("low","mid","high"),$options=3;for(var b in $filters)a('.item[data-budget="'+$filters[b]+'"]').length||(a('a[data-value="'+$filters[b]+'"]').parent("li").hide(),$options--);a("#budget ul.inline").addClass("options_"+$options),1==$options&&a("#budget").hide()}function f(){a("#form_listing .toggle_checkbox").on("click",function(){return a(this).toggleClass("on"),a('input[name="'+a(this).attr("data-target")+'"]').click(),!1}),a("#form_listing .label_checkbox").on("click",function(){return a(this).prev(".toggle_checkbox").click(),!1}),a("#listato #filter_area .field .lbl").on("click",function(){return a(this).parent(".field").find(".toggle_checkbox").click(),!1}),a("#form_listing .toggle_radio").on("click",function(){return $target=a('input[value="'+a(this).attr("data-target")+'"]'),$target_name=$target.attr("name"),a(this).hasClass("on")?(a(this).toggleClass("on"),$target.prop("checked",!1)):(a('input[name="'+$target_name+'"]').each(function(){a(this).parents().find(".toggle_radio").removeClass("on")}),$target.prop("checked",!0),a(this).toggleClass("on")),!1}),a("#form_listing .label_radio").on("click",function(){return a(this).prev(".toggle_radio").click(),!1}),a("#form_listing #budget a").on("click",function(){return a('input[name="budget"]').val(a(this).attr("data-value")),a(this).parents("ul").find("a").removeClass("active"),a(this).addClass("active"),!1})}function g(){a("#city_top .btns a").on("click",function(){return a(a(this).attr("href")).addClass("open"),!1}),a("#city_top .layer a.btn_custom").on("click",function(){return a(this).parents(".layer").removeClass("open"),!1})}function h(){$map_latlon=a("#city_map").attr("data-latlon"),$map_latlon=$map_latlon.split(",");var b=new google.maps.LatLng($map_latlon[0],$map_latlon[1]),d={center:b,zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1},e=new google.maps.Map(document.getElementById("city_map"),d);$x=1,a("#maplist .point").each(function(){if($pin_id=a(this).attr("data-id"),!a("#hotel_"+$pin_id).hasClass("hidden")){if($map_latlon=a(this).attr("data-latlon"),""!=$map_latlon){$map_latlon=$map_latlon.split(",");var b=new google.maps.LatLng($map_latlon[0],$map_latlon[1]),d=c+"/img/pin/"+parseInt($x)+".png",f=new google.maps.Marker({position:b,map:e,icon:d,hotel_id:$pin_id,count:parseInt($x)});google.maps.event.addListener(f,"click",function(){a("#maplist .box_group").empty(),a("#maplist .box_group").html('<div class="box htl">'+a("#hotel_"+this.hotel_id).html()+"</div>"),a("html, body").animate({scrollTop:a("#action_bar").offset().top},400,k)}),google.maps.event.addListener(f,"mouseover",function(){f.setIcon(c+"/img/pin/"+this.count+"_hover.png")}),google.maps.event.addListener(f,"mouseout",function(){f.setIcon(c+"/img/pin/"+this.count+".png")})}$x++}})}function i(){function c(){a(".item").removeClass("hidden").show(),a("#filter_area #facilities input:checked").each(function(){$name=a(this).prop("name"),a(".item[data-"+$name+'="off"]').addClass("hidden").hide()}),$side=a('input[name="side"]:checked').val(),$side&&a('.item[data-side!="'+$side+'"]').addClass("hidden").hide(),$budget=a('input[name="budget"]').val(),"all"!=$budget&&a('.item[data-budget!="'+$budget+'"]').addClass("hidden").hide(),j()}$form_filter=a("#form_listing"),a("#filter_area #facilities span.sprite").on("click",function(){c()}),a("#filter_area #type_villa span.sprite").on("click",function(){c()}),a("#filter_area #budget a").on("click",function(){c()}),a("#filter_area #submitter").on("click",function(){return $city=a('select[name="city"]').val(),$bedroom=a('select[name="camere_letto"]').val(),$people=a('select[name="posti_letto"]').val(),TUSCANY.ajaxNavigation.loadPage(b+""+$city+"/?f="+$bedroom+"|"+$people),!1})}function j(){a("#action_bar span").first().text(a("#items .item:visible").length+" VILLAS")}function l(){a("#action_bar .switcher a").on("click",function(){switch(a("#action_bar .switcher a span").removeClass("on"),a(this).find("span").addClass("on"),$target=a(this).attr("href")){case"#listato":a("#maplist").hide(),a("#listato").show();break;case"#maplist":a("#listato").hide(),a("#maplist").show(),h()}return!1})}function o(){a("#toggle_filter_area").on("click",function(){a("#toggle_filter_area").hasClass("open")?(a("#filter_area").animate({left:-340},400,k),a("#toggle_filter_area").removeClass("open")):(a("#filter_area").animate({left:0},400,k),a("#toggle_filter_area").addClass("open")),q&&q.hide(),r&&r.hide()});a(window).bind("throttledresize",function(){p&&a("#filter_area").css("left",0),p||a("#filter_area").css("left",-340),a("#toggle_filter_area").removeClass("open")})}function s(){a("#city_top .image").swipe({swipeLeft:function(){n?(a("#city_top .image").animate({left:"-640px"}),a("#city_top .map").animate({left:"-640px"})):m&&(a("#city_top .image").animate({left:"-320px"}),a("#city_top .map").animate({left:"-320px"}))}}),a("#city_top .map").swipe({swipeRight:function(){(n||m)&&(a("#city_top .image").animate({left:"0"}),a("#city_top .map").animate({left:"0"}))}});a(window).bind("throttledresize",function(){a("#city_top .image").css("left",0),a("#city_top .map").css("left",0)})}function t(){a("#items>.item").tsort(".order_name",{order:"asc"}),a("#orderby").on("change",function(){$val=a(this).val(),a("#items>.item").tsort("."+$val,{order:"asc"})})}function u(){a("#action_bar").sticky({topSpacing:63})}this.changePage(),d(),e(),f(),g(),i(),l(),o(),s(),t(),u()},TUSCANY.tplAbout=function(){this.changePage()},TUSCANY.tplReviews=function(){this.changePage(),a("#view_all").sticky({topSpacing:63})},TUSCANY.tplHotel=function(){function b(){a(".tab_item").on("click",function(){return $item=a(this),$item.hasClass("active")||($item.siblings().removeClass("active"),$target=a($item.attr("href")),$target.siblings(".active").hide(),a(".tab_item.active").hide().removeClass("active"),$item.addClass("active"),$target.show().addClass("active")),!1})}function c(){a("a.open_popup").colorbox({inline:!0,initialWidth:0,initialHeight:0,fixed:!0}),a(".close_popup").on("click",function(){return a.colorbox.close(),!1})}function d(){a("a.back").on("click",function(){return History.back(),!1})}function e(){a("a.nav").on("click",function(){return $target=a(a(this).attr("href")),$offset=a("#hotel_top").height()+a("header").height(),a("html, body").animate({scrollTop:parseInt($target.offset().top)-$offset},400,k),!1}),a("#hotel_top").sticky({topSpacing:63})}function f(a){return a=a.split("/"),a=new Date(a[2],a[0]-1,a[1])}function g(a,b){return rangeInDays=(b-a)/864e5,rangeInDays/7|0}function h(a){return[a.getDate()<10?"0"+a.getDate():a.getDate(),a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,a.getFullYear()].join("")}function i(){return a("[data-hotel-id]").attr("data-hotel-id")}function j(){$price_day=a("#price_total").attr("data-price-day"),$start_date=f(a('input[name="start_date"]').val()),$end_date=f(a('input[name="end_date"]').val()),a("#price_total_wrapper").fadeIn(),a("#price_total").text("Calculating..."),a.ajax({type:"GET",dataType:"json",url:"/bookingdom.php?property_id="+i()+"&start_date="+h($start_date)+"&end_date="+h($end_date),success:function(b){a("#price_total").html(b.calculatedPrice)}}),$weeks=g($start_date,$end_date),$weeks||($weeks=1),$days=($end_date-$start_date)/864e5,$days>0?a("#week_total").html($weeks):(a("#price_total").text("Wrong Dates"),a("#week_total").html("No"))}function l(){checkIn=a("#start_date_hotel").datepicker({}).on("changeDate",function(a){var b=new Date(a.date);b.setDate(b.getDate()+7),checkOut.setValue(b),checkIn.hide()}).on("show",function(){checkOut.hide()}).data("datepicker"),checkOut=a("#end_date_hotel").datepicker({}).on("changeDate",function(){checkOut.hide(),j()}).on("show",function(){checkIn.hide()}).data("datepicker")}function m(){a("#hotel_reviews .flexslider").flexslider({animation:"slide",controlNav:!0,directionNav:!1})}this.changePage(),a(window).bind("throttledresize",function(){}),b(),c(),d(),e(),a("#form_write_us").jmValidation({type:"ajax",service:a("#form_write_us").attr("action")}),l(),m()},TUSCANY.fixColorbox=function(){function b(){c&&clearTimeout(c),c=setTimeout(function(){a("#cboxOverlay").is(":visible")&&a.colorbox.load(!0)},300)}var c;a(window).bind("throttledresize",function(){b()})},TUSCANY.changePage=function(){this.ajaxNavigation.content(),this.customSelect(),this.parallax(),j=!1},TUSCANY.menu=function(){a("header").sticky()},TUSCANY.init=function(){this.preloading(),this.detectScreen(),this.menu(),this.ajaxNavigation.header(),this.parseCallback(),this.cityMenu(),this.fixColorbox(),a(window).bind("throttledresize",function(){TUSCANY.detectScreen()})},TUSCANY.init(),morepage_loading=!1,a(".morepage").appear(),a(document.body).on("appear",".morepage",function(){morepage_loading||(morepage_loading=!0,console.log(a(this).attr("data-page")),a.post("/ajax",{action:"morepage",data:a(this).attr("data-page"),paged:a(this).attr("data-page")},function(b){a(".morepage").remove(),morepage_loading=!1,a("#items").append(b)}))}),gallery_loading=!1,a(".loadslide").appear(),a(document.body).on("appear",".loadslide",function(){a("#main_gallery .loader").show(),gallery_loading||(console.log("data-gallery: "+a(this).attr("data-gallery")),gallery_loading=!0,console.log("attivazione caricamento thumb"),a.post("/ajax",{action:"thumb_gallery",data:a(this).attr("data-page"),thumb_gallery:a(this).attr("data-gallery")},function(b){console.log("caricemento thumb completato"),a("#thumbs_gallery").append(b),a("#thumbs_gallery").flexslider({animation:"slide",controlNav:!1,animationLoop:!0,slideshow:!1,itemWidth:52,itemMargin:5,asNavFor:"#main_gallery"}),a("#main_gallery .loader").fadeOut(),a("#thumbs_gallery").css("z-index",99)}),console.log("attivazione caricamento gallery"),a.post("/ajax",{action:"hotel_gallery",data:a(this).attr("data-page"),hotel_gallery:a(this).attr("data-gallery")},function(b){console.log("caricemento full completato"),a(".loadslide").remove(),a("#main_gallery").append(b),console.log("attivo gallery da da full"),a("#main_gallery").flexslider({animation:"fade",controlNav:!1,animationLoop:!1,slideshow:!1,sync:"#thumbs_gallery",after:function(b){$img=b.slides.eq(b.currentSlide).find("img"),void 0==$img.attr("src")&&(a("#main_gallery .loader").show(),tempimg=new Image,tempimg.onload=function(){console.log("load:: "+$img.attr("data-original")),$img.attr("src",$img.attr("data-original")),a("#main_gallery .loader").delay(200).fadeOut()},tempimg.src=$img.attr("data-original"))}})}))});var s=!1;setInterval(function(){s&&(s=!1,a.force_appear(),a(".morepage").is(":appeared")&&console.log("morepage è visibile"))},500)});